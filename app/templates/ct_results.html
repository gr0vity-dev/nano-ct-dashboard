<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data View</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet" />

    <style>
      .test-status-icon {
        display: inline-block;
        font-size: 1rem;
        width: 1.5rem;
        height: 1.5rem;
        text-align: center;
        line-height: 1.5rem;
      }

      .pass-status {
        color: #34d399; /* Tailwind's green-500 */
      }

      .warn-status {
        color: #fbbf24; /* Tailwind's yellow-500 */
      }

      .fail-status {
        color: #f87171; /* Tailwind's red-500 */
      }

      .item-separator {
        border-bottom: 2px dashed #e5e7eb; /* A light gray color */
      }
    </style>
  </head>

  <body class="bg-gray-100 py-6">
    <div class="container mx-auto px-4">
      <table class="bg-white divide-y divide-gray-200">
        <thead>
          <tr class="text-gray-600 uppercase text-xs font-semibold">
            <th class="py-2 px-2 text-left">User</th>
            <th class="py-2 px-2 text-left">Type</th>
            <th class="py-2 px-2 text-left">Status</th>
            <th class="py-2 px-1 text-left">Duration</th>
            <th class="py-2 px-1 text-left">Test Age</th>
            <th class="py-2 px-1 text-left">Hash</th>
            <th class="py-2 px-1 text-left">PR# (Rev.)</th>
            <th class="py-2 px-1 text-left whitespace-nowrap">Commit In</th>
            <th class="py-2 px-1 text-left">Pass/Fail</th>
          </tr>
        </thead>
        <tbody class="text-gray-600 text-sm font-light">
          {% for item in data %}
          <tr class="bg-gray-200">
            <td colspan="10" class="py-1 px-1 font-medium">{{ item.pr_title }}</td>
          </tr>
          {% if not item.build_status in ["pass" , "building"] %}
          <tr class="bg-gray-200">
            <td colspan="10" class="py-1 px-1 font-medium">
              Build failed for
              <a href="{{ item.hash_url }}">{{ item.hash }}</a>
            </td>
          </tr>
          {% else %}
          <tr class="hover:bg-gray-100 item-separator" onclick="toggleDetails('details-{{ loop.index }}')">
            <td>
              <img
                src="https://github.com/{{ item.pr_user }}.png?s=40"
                alt="{{ item.pr_user }}"
                class="rounded-full w-10 h-10"
              />
            </td>
            <td>
              <a href="{{ item.diff_url }}" class="text-blue-500">
                <img src="{{ url_for('static', filename='images/' + item.type + '.png') }}" alt="{{ item.type }}" />
              </a>
            </td>
            <td class="py-2 px-1">
              {% if item.test_status == 'PASS' %}
              <span class="test-status-icon pass-status">&#10004;</span>
              {% elif item.test_status == 'WARN' %}
              <span class="test-status-icon warn-status">&#9888;</span>
              {% else %}
              <span class="test-status-icon fail-status">&#10006;</span>
              {% endif %}
            </td>
            <td class="py-2 px-1">{{ item.test_duration }}</td>
            <td class="py-2 px-1">{{ item.test_age }}</td>
            <td class="py-2 px-1"><a href="{{ item.hash_url }}" class="text-blue-500">{{ item.hash }}</a></td>
            <td class="py-2 px-1 whitespace-nowrap">
              <a href="{{ item.pr_url }}" class="text-blue-500">{{ item.pr_number }}</a>
              (rev {{ item.revision_number }})
            </td>
            <td class="py-2 px-1">{{ item.duration_from_first_pr_to_commit }}</td>
            <td class="py-2 px-1">Pass: {{ item.pass_count }}, Fail: {{ item.fail_count }}</td>
          </tr>
          <tr id="details-{{ loop.index }}" class="hidden">
            <td colspan="10" class="py-3 px-1">
              <table class="table-auto border-collapse">
                <thead>
                  <tr>
                    <th class="border px-2 py-1 text-left">Testcase</th>
                    <th class="border px-2 py-1 text-left">Status</th>
                    <th class="border px-2 py-1 text-left">Duration</th>
                    <th class="border px-2 py-1 text-left">Median Duration</th>
                    <th class="border px-2 py-1 text-left">Deviation from Median</th>
                  </tr>
                </thead>
                <tbody>
                  {% for test in item.testcases %}
                  <tr>
                    <td class="border px-2 py-1">{{ test.testcase }}</td>
                    <td class="border px-2 py-1">
                      {% if test.status == 'PASS' %}
                      <span class="test-status-icon pass-status">&#10004;</span>
                      {% elif test.status == 'WARN' %}
                      <span class="test-status-icon warn-status">&#9888;</span>
                      {% else %}
                      <span class="test-status-icon fail-status">&#10006;</span>
                      {% endif %}
                    </td>
                    <td class="border px-2 py-1">{{ test.duration }}</td>
                    <td class="border px-2 py-1">{{ test.commit_median_duration }}</td>
                    <td class="border px-2 py-1">{{ test.deviation_from_median }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </td>
          </tr>
          <tr>
            <td colspan="10" class="py-1"></td>
          </tr>
          {% endif %} {% endfor %}
        </tbody>
      </table>
    </div>

    <script>
      function toggleDetails(id) {
        const detailsElem = document.getElementById(id);
        if (detailsElem.classList.contains("hidden")) {
          detailsElem.classList.remove("hidden");
        } else {
          detailsElem.classList.add("hidden");
        }
      }
    </script>
  </body>
</html>
